# 实时搜索功能说明

## ⚠️ 当前状态：测试中

实时搜索功能已集成，但搜索结果可能不完全准确。

## 🔍 已知问题

### 问题：返回历史数据

**现象**：
```
用户：/search 黄金最新什么价了
AI：截至 2023 年 10 月...  ❌（返回过时数据）
```

**可能原因**：
1. AIHubMix Surfing 功能可能需要特定配置
2. 模型可能没有正确使用搜索结果
3. Tavily 搜索可能有延迟或限制

## 📊 调试信息

使用 `/search` 命令后，查看日志：

```bash
docker logs notifyhub | grep -E "Web search|Search response|Actual model"
```

**关键日志**：
```
[INFO] Web search using model: gpt-4o-mini:surfing, query: 黄金最新价格
[INFO] Search response model: gpt-4o-mini-2024-07-18
[INFO] Search response usage: {...}
[INFO] Actual model used: gpt-4o-mini-2024-07-18
```

**检查点**：
- ✅ 模型名称包含 `:surfing`
- ⚠️ 响应模型是否有搜索标记
- ⚠️ usage 中的 token 数量（搜索会增加 prompt_tokens）

## 🔧 可能的解决方案

### 方案 1：等待 AIHubMix 优化

AIHubMix Surfing 功能可能：
- 正在完善中
- 需要特定的账户权限
- 有使用配额限制

### 方案 2：检查模型支持

并非所有模型都支持 `:surfing` 后缀，可尝试：
- `gpt-4o:surfing`
- `gpt-4o-mini:surfing`
- `claude-3-5-sonnet-20241022:surfing`

### 方案 3：查看 API 文档

参考 [AIHubMix 文档](https://docs.aihubmix.com/cn)，查看：
- Surfing 功能的最新说明
- 是否需要额外参数
- 是否有使用限制

## 💡 当前替代方案

在搜索功能完善前，可以：

### 使用普通对话
```
用户：黄金价格大概多少？
AI：根据我的知识，黄金价格通常在...（知识截止）
```

### 手动验证信息
```
1. 使用 /search 获取参考信息
2. 自行访问 AI 提供的链接
3. 验证数据准确性
```

## 📝 反馈渠道

如果您发现：
- ✅ 搜索返回了准确的实时数据
- ❌ 搜索结果不准确
- ℹ️ 其他问题

请查看日志并反馈给开发者。

## 🎯 未来计划

### 短期（v0.0.3）
- [ ] 优化搜索提示词
- [ ] 测试不同模型的搜索效果
- [ ] 添加搜索结果验证
- [ ] 完善错误处理

### 中期（v0.1.0）
- [ ] 可选搜索引擎（Tavily / Google / Bing）
- [ ] 搜索结果缓存
- [ ] 搜索历史记录
- [ ] 成本统计

## 🔍 诊断步骤

### 1. 查看请求日志
```bash
docker logs notifyhub | grep "Web search using model"
```

### 2. 查看响应日志
```bash
docker logs notifyhub | grep "Search response"
```

### 3. 对比普通对话
```
# 普通对话
用户：今天日期
AI：[使用 gpt-4o-mini，无 :surfing]

# 搜索
用户：/search 今天日期
AI：[使用 gpt-4o-mini:surfing]
```

看是否有差异。

## 📊 测试建议

### 测试 1：简单问题
```
/search 今天是几号
/search 现在几点
```

### 测试 2：实时信息
```
/search 今天北京天气
/search 比特币当前价格
```

### 测试 3：最新新闻
```
/search AI 最新消息
/search Python 最新版本
```

记录哪些类型的问题能获得准确答案。

## 🎯 当前建议

**推荐做法**：
- ⚠️ 默认关闭实时搜索（已修改为 `defaultValue: false`）
- ✅ 需要时手动启用测试
- ✅ 对搜索结果保持谨慎

**主要使用**：
- ✅ AI 对话（稳定可靠）
- ✅ 图片功能（完全正常）
- ✅ 语音功能（完全正常）

---

**状态**：⚠️ 实验功能  
**版本**：0.0.2  
**开发者**：dysobo

