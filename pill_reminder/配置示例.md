# 用药提醒配置示例

## 逻辑优先级说明

系统按以下优先级处理提醒时间：

1. **用药时间段配置**（最高优先级）
2. 每日提醒时间
3. 传统药品配置

## 配置示例

### 示例1：使用用药时间段配置（支持多渠道）

**配置：**
- 默认发送渠道：微信
- 用药时间1：08:00
- 用药时间1名称：上午用药
- 用药时间1-药品1：维生素C - 1片 [https://example.com/vitamin-c.jpg] [微信]
- 用药时间1-药品2：钙片 - 2片 [https://example.com/calcium.jpg] [钉钉]
- 用药时间1-药品3：叶酸 - 1粒
- 用药时间1-药品4：维生素B12 - 1粒 [微信]
- 用药时间1-药品5：鱼油 - 2粒 [钉钉]

- 用药时间3：20:00
- 用药时间3名称：晚上用药
- 用药时间3-药品1：【倍博特】缬沙坦氨氯地平 - 2片(80+5）mg*2 [https://icon.dysobo.cn:888/icons/upload/Screenshot_20251002_021405_com_sankuai_meituan_WmAlbumActivity.jpg] [微信]
- 用药时间3-药品2：【倍他乐克】琥珀酸美托洛尔缓释片 - 2片(47.5mg*2) [https://icon.dysobo.cn:888/icons/upload/Screenshot_20251002_021438_com_sankuai_meituan_WmAlbumActivity.jpg] [钉钉]
- 用药时间3-药品3：维生素D - 1粒
- 用药时间3-药品4：益生菌 - 1包 [微信]
- 用药时间3-药品5：褪黑素 - 1粒 [钉钉]

- 用药时间5：14:00
- 用药时间5名称：下午用药
- 用药时间5-药品1：维生素E - 1粒 [微信]
- 用药时间5-药品2：辅酶Q10 - 1粒 [钉钉]

**结果：**
- 系统会在 08:00 发送上午用药提醒：
  - 第一条：上午用药清单（发送到微信，使用第一个药品的渠道）
  - 30秒后第二条：维生素C（发送到微信）
  - 30秒后第三条：钙片（发送到钉钉）
  - 30秒后第四条：叶酸（发送到微信，默认渠道）
  - 30秒后第五条：维生素B12（发送到微信）
  - 30秒后第六条：鱼油（发送到钉钉）
- 系统会在 14:00 发送下午用药提醒：
  - 第一条：下午用药清单（发送到微信，使用第一个药品的渠道）
  - 30秒后第二条：维生素E（发送到微信）
  - 30秒后第三条：辅酶Q10（发送到钉钉）
- 系统会在 20:00 发送晚上用药提醒：
  - 第一条：晚上用药清单（发送到微信，使用第一个药品的渠道）
  - 30秒后第二条：倍博特（发送到微信）
  - 30秒后第三条：倍他乐克（发送到钉钉）
  - 30秒后第四条：维生素D（发送到微信，默认渠道）
  - 30秒后第五条：益生菌（发送到微信）
  - 30秒后第六条：褪黑素（发送到钉钉）
- 忽略"每日提醒时间"设置

### 示例2：使用每日提醒时间

**配置：**
- 默认发送渠道：微信
- 提醒计划类型：每日固定时间
- 每日提醒时间：08:00, 20:00
- 药品名称：日常用药
- 用药量：1片

**结果：**
- 系统会在 08:00 和 20:00 发送提醒
- 使用传统药品配置
- 所有消息发送到微信渠道

### 示例3：混合配置（不推荐）

**配置：**
- 默认发送渠道：微信
- 每日提醒时间：08:00, 20:00
- 用药时间1：08:00
- 用药时间1名称：早餐后用药
- 用药时间1-药品1：维生素C - 1片 [钉钉]

**结果：**
- 系统会在 08:00 发送早餐后用药提醒：
  - 第一条：早餐后用药清单（发送到钉钉，使用第一个药品的渠道）
  - 30秒后第二条：维生素C（发送到钉钉）
- 系统会在 20:00 发送传统提醒（日常用药，发送到微信）
- 注意：08:00 的每日提醒时间被忽略

## 状态查询

访问 `/api/plugins/pill_reminder/status` 可以查看当前使用的配置类型：

```json
{
  "ok": true,
  "default_channel": "微信",
  "using_medicine_groups": true,
  "active_times": ["08:00", "14:00", "20:00"],
  "note": "使用用药时间段配置，忽略计划类型设置",
  "medicine_groups": {
    "上午用药": {
      "time": "08:00",
      "medicines_count": 5,
      "medicines": [
        {"name": "维生素C", "dosage": "1片", "channel": "微信", "has_image": true},
        {"name": "钙片", "dosage": "2片", "channel": "钉钉", "has_image": true},
        {"name": "叶酸", "dosage": "1粒", "channel": "微信", "has_image": false},
        {"name": "维生素B12", "dosage": "1粒", "channel": "微信", "has_image": false},
        {"name": "鱼油", "dosage": "2粒", "channel": "钉钉", "has_image": false}
      ]
    },
    "下午用药": {
      "time": "14:00",
      "medicines_count": 2,
      "medicines": [
        {"name": "维生素E", "dosage": "1粒", "channel": "微信", "has_image": false},
        {"name": "辅酶Q10", "dosage": "1粒", "channel": "钉钉", "has_image": false}
      ]
    },
    "晚上用药": {
      "time": "20:00",
      "medicines_count": 5,
      "medicines": [
        {"name": "倍博特", "dosage": "2片", "channel": "微信", "has_image": true},
        {"name": "倍他乐克", "dosage": "2片", "channel": "钉钉", "has_image": true},
        {"name": "维生素D", "dosage": "1粒", "channel": "微信", "has_image": false},
        {"name": "益生菌", "dosage": "1包", "channel": "微信", "has_image": false},
        {"name": "褪黑素", "dosage": "1粒", "channel": "钉钉", "has_image": false}
      ]
    }
  }
}
```
